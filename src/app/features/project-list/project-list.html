<!-- List Header -->
<div class="list-header">

  <div class="list-title">
    <i class="fa-solid fa-chart-pie"></i>
    <span>Project List</span>
    <span class="list-count">{{ filteredProjects().length }}</span>
  </div>

  <div class="list-actions">

    <!-- Search -->
    <div class="search-box">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
      <input
        class="search-input"
        [(ngModel)]="searchText"
        placeholder="Search project, CA, chain...">
    </div>

    <!-- Risk Filter -->
    <select class="filter-select" [(ngModel)]="riskFilter">
      <option value="">All Risk</option>
      <option value="Low">ðŸŸ¢ Low</option>
      <option value="Medium">ðŸŸ¡ Medium</option>
      <option value="High">ðŸ”´ High</option>
    </select>

    <!-- Add Button -->
    <button class="add-btn" (click)="toggleForm()">
      <i class="fa-solid" [ngClass]="showForm ? 'fa-xmark' : 'fa-plus'"></i>
      {{ showForm ? 'Close' : 'Add Project' }}
    </button>

  </div>

</div>

<!-- Toggle Form -->
<div *ngIf="showForm" class="mb-4">
  <app-project-form (save)="handleSave($event)"></app-project-form>
</div>

<!-- Empty State -->
<div *ngIf="filteredProjects().length === 0" class="empty-state">
  <div class="empty-icon">
    <i class="fa-solid fa-folder-open"></i>
  </div>
  <div class="empty-title">No projects found</div>
  <div class="empty-sub">Add your first crypto project to get started</div>
</div>

<!-- Cards Grid -->
<div class="projects-grid">

  <div class="project-card" *ngFor="let p of filteredProjects()">

    <!-- Card Top Glow Line (colored by risk) -->
    <div class="card-risk-line"
         [ngClass]="{
           'risk-low':    p.riskLevel === 'Low',
           'risk-medium': p.riskLevel === 'Medium',
           'risk-high':   p.riskLevel === 'High'
         }">
    </div>

    <div class="card-inner">

      <!-- Header Row -->
      <div class="card-header-row">
        <div class="card-title-block">
          <div class="card-project-name">
            <i class="fa-solid fa-diagram-project"></i>
            {{ p.project || 'â€”' }}
          </div>
          <div class="card-date">
            <i class="fa-regular fa-calendar"></i>
            {{ p.createdAt | date:'dd MMM yyyy, hh:mm a' }}
          </div>
        </div>

        <span class="risk-badge"
              [ngClass]="{
                'risk-badge-low':    p.riskLevel === 'Low',
                'risk-badge-medium': p.riskLevel === 'Medium',
                'risk-badge-high':   p.riskLevel === 'High'
              }">
          <i class="fa-solid fa-triangle-exclamation"></i>
          {{ p.riskLevel }}
        </span>
      </div>

      <div class="card-divider"></div>

      <!-- Details -->
      <div class="card-details">

        <div class="detail-row">
          <i class="fa-brands fa-x-twitter"></i>
          <span>{{ p.handle || 'â€”' }}</span>
        </div>

       <div class="detail-row ca-row" (click)="openGMGN(p.ca, p.chain)" title="Click to open on GMGN">
  <i class="fa-solid fa-fingerprint"></i>
  <span class="ca-text">{{ p.ca || 'â€”' }}</span>
  <i class="fa-solid fa-arrow-up-right-from-square ca-copy-icon"></i>
</div>

        <div class="detail-row">
          <i class="fa-solid fa-layer-group"></i>
          <span>{{ p.category || 'â€”' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-link"></i>
          <span class="chain-badge">{{ p.chain || 'â€”' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-hashtag"></i>
          <span>{{ p.narrativeTag || 'â€”' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-lightbulb"></i>
          <span>{{ p.useCase || 'â€”' }}</span>
        </div>

      </div>

      <div class="card-divider"></div>

      <!-- Stats Row -->
      <div class="card-stats">

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-chart-line"></i> Market Cap
          </div>
          <div class="stat-block-val">
            {{ p.marketCap ? ('$' + (p.marketCap | number)) : 'â€”' }}
          </div>
        </div>

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-star"></i> Rating
          </div>
          <div class="stat-block-val">{{ p.rating || 'â€”' }}/10</div>
        </div>

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-sack-dollar"></i> Return
          </div>
          <div class="stat-block-val"
               [ngClass]="{
                 'val-success': p.returnValue > 0,
                 'val-danger':  p.returnValue < 0,
                 'val-muted':  !p.returnValue
               }">
            {{ p.returnValue ? (p.returnValue + 'x') : 'â€”' }}
          </div>
        </div>

      </div>

      <!-- Return Edit Input -->
      <div *ngIf="editingReturnId === p.id" class="return-edit-box">
        <div class="return-edit-inner">
          <span class="return-edit-prefix">
            <i class="fa-solid fa-sack-dollar"></i>
          </span>
          <input
            type="number"
            class="return-edit-input"
            placeholder="e.g. 5.2"
            [(ngModel)]="returnInputValue"
            min="0"
            step="0.1"
          />
          <span class="return-edit-suffix">x</span>
          <button class="return-confirm-btn" (click)="saveReturn(p)">
            <i class="fa-solid fa-check"></i>
          </button>
          <button class="return-cancel-btn" (click)="cancelReturn()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="card-actions">

        <button class="action-btn return-btn"
                [class.active]="editingReturnId === p.id"
                (click)="toggleReturnEdit(p)">
          <i class="fa-solid fa-sack-dollar"></i>
          {{ editingReturnId === p.id ? 'Cancel' : (p.returnValue ? 'Edit Return' : 'Add Return') }}
        </button>

        <button class="action-btn delete-btn" (click)="delete(p.id)">
          <i class="fa-solid fa-trash"></i>
          Delete
        </button>

      </div>

    </div>
  </div>

</div>
