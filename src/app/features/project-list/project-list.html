<!-- List Header -->
<div class="list-header">

  <div class="list-title">
    <i class="fa-solid fa-chart-pie"></i>
    <span>Project List</span>
    <span class="list-count">{{ filteredProjects().length }}</span>
  </div>

  <div class="list-actions">

    <!-- Search -->
    <div class="search-box">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
      <input
        class="search-input"
        [(ngModel)]="searchText"
        placeholder="Search project, CA, chain...">
    </div>

    <!-- Risk Filter -->
    <div class="risk-filter-group">
      <button class="risk-filter-btn"
              [class.active]="riskFilter === ''"
              (click)="riskFilter = ''">
        <i class="fa-solid fa-layer-group"></i>
        All
      </button>
      <button class="risk-filter-btn low"
              [class.active]="riskFilter === 'Low'"
              (click)="riskFilter = 'Low'">
        <i class="fa-solid fa-shield-halved"></i>
        Low
      </button>
      <button class="risk-filter-btn medium"
              [class.active]="riskFilter === 'Medium'"
              (click)="riskFilter = 'Medium'">
        <i class="fa-solid fa-circle-half-stroke"></i>
        Medium
      </button>
      <button class="risk-filter-btn high"
              [class.active]="riskFilter === 'High'"
              (click)="riskFilter = 'High'">
        <i class="fa-solid fa-skull-crossbones"></i>
        High
      </button>
    </div>

    <!-- Add Button -->
    <button class="add-btn" (click)="toggleForm()">
      <i class="fa-solid" [ngClass]="showForm ? 'fa-xmark' : 'fa-plus'"></i>
      {{ showForm ? 'Close' : 'Add Project' }}
    </button>

  </div>

</div>

<!-- Toggle Form -->
<div *ngIf="showForm" class="mb-4">
  <app-project-form (save)="handleSave($event)"></app-project-form>
</div>

<!-- Empty State -->
<div *ngIf="filteredProjects().length === 0" class="empty-state">
  <div class="empty-icon">
    <i class="fa-solid fa-folder-open"></i>
  </div>
  <div class="empty-title">No projects found</div>
  <div class="empty-sub">Add your first crypto project to get started</div>
</div>

<!-- Cards Grid -->
<div class="projects-grid">

  <div class="project-card" *ngFor="let p of filteredProjects()">

    <!-- Card Top Glow Line (colored by risk) -->
    <div class="card-risk-line"
         [ngClass]="{
           'risk-low':    p.riskLevel === 'Low',
           'risk-medium': p.riskLevel === 'Medium',
           'risk-high':   p.riskLevel === 'High'
         }">
    </div>

    <div class="card-inner">

      <!-- Header Row -->
      <div class="card-header-row">
        <div class="card-title-block">
          <div class="card-project-name">
            <i class="fa-solid fa-diagram-project"></i>
            {{ p.project || '—' }}
          </div>
          <div class="card-date">
            <i class="fa-regular fa-calendar"></i>
            {{ p.createdAt | date:'dd MMM yyyy, hh:mm a' }}
          </div>
        </div>

        <span class="risk-badge"
              [ngClass]="{
                'risk-badge-low':    p.riskLevel === 'Low',
                'risk-badge-medium': p.riskLevel === 'Medium',
                'risk-badge-high':   p.riskLevel === 'High'
              }">
          <i class="fa-solid fa-triangle-exclamation"></i>
          {{ p.riskLevel }}
        </span>
      </div>

      <div class="card-divider"></div>

      <!-- Details -->
      <div class="card-details">

        <div class="detail-row">
          <i class="fa-brands fa-x-twitter"></i>
          <span>{{ p.handle || '—' }}</span>
        </div>

        <div class="detail-row ca-row" (click)="openGMGN(p.ca, p.chain)" title="Click to open on GMGN">
          <i class="fa-solid fa-fingerprint"></i>
          <span class="ca-text">{{ p.ca || '—' }}</span>
          <i class="fa-solid fa-arrow-up-right-from-square ca-copy-icon"></i>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-layer-group"></i>
          <span>{{ p.category || '—' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-link"></i>
          <span class="chain-badge">{{ p.chain || '—' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-hashtag"></i>
          <span>{{ p.narrativeTag || '—' }}</span>
        </div>

        <div class="detail-row">
          <i class="fa-solid fa-lightbulb"></i>
          <span>{{ p.useCase || '—' }}</span>
        </div>

      </div>

      <div class="card-divider"></div>

      <!-- Stats Row -->
      <div class="card-stats">

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-chart-line"></i> Market Cap
          </div>
          <div class="stat-block-val">
            {{ p.marketCap ? ('$' + p.marketCap) : '—' }}
          </div>
        </div>

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-star"></i> Rating
          </div>
          <div class="stat-block-val">{{ p.rating || '—' }}/10</div>
        </div>

        <div class="stat-block">
          <div class="stat-block-label">
            <i class="fa-solid fa-sack-dollar"></i> Return
          </div>
          <div class="stat-block-val"
               [ngClass]="{
                 'val-success': p.returnValue > 0,
                 'val-danger':  p.returnValue < 0,
                 'val-muted':  !p.returnValue
               }">
            {{ p.returnValue ? (p.returnValue + 'x') : '—' }}
          </div>
        </div>

      </div>

      <!-- Return Edit Input -->
      <div *ngIf="editingReturnId === p.id" class="return-edit-box">
        <div class="return-edit-inner">
          <span class="return-edit-prefix">
            <i class="fa-solid fa-sack-dollar"></i>
          </span>
          <input
            type="number"
            class="return-edit-input"
            placeholder="e.g. 5.2"
            [(ngModel)]="returnInputValue"
            min="0"
            step="0.1"
          />
          <span class="return-edit-suffix">x</span>
          <button class="return-confirm-btn" (click)="saveReturn(p)">
            <i class="fa-solid fa-check"></i>
          </button>
          <button class="return-cancel-btn" (click)="cancelReturn()">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>

      <!-- ✏️ Inline Edit Panel -->
      <div *ngIf="editingProjectId === p.id" class="project-edit-box">
        <div class="project-edit-grid">

          <div class="edit-field">
            <label><i class="fa-solid fa-diagram-project"></i> Project Name</label>
            <input type="text" [(ngModel)]="editDraft.project" placeholder="Project name" />
          </div>

          <div class="edit-field">
            <label><i class="fa-brands fa-x-twitter"></i> Handle</label>
            <input type="text" [(ngModel)]="editDraft.handle" placeholder="@handle" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-fingerprint"></i> CA</label>
            <input type="text" [(ngModel)]="editDraft.ca" placeholder="Contract address" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-link"></i> Chain</label>
            <input type="text" [(ngModel)]="editDraft.chain" placeholder="e.g. ETH, SOL" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-layer-group"></i> Category</label>
            <input type="text" [(ngModel)]="editDraft.category" placeholder="Category" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-hashtag"></i> Narrative Tag</label>
            <input type="text" [(ngModel)]="editDraft.narrativeTag" placeholder="Narrative tag" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-lightbulb"></i> Use Case</label>
            <input type="text" [(ngModel)]="editDraft.useCase" placeholder="Use case" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-chart-line"></i> Market Cap</label>
            <input type="text" [(ngModel)]="editDraft.marketCap" placeholder="e.g. 1.2M" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-star"></i> Rating</label>
            <input type="number" [(ngModel)]="editDraft.rating" placeholder="1–10" min="1" max="10" />
          </div>

          <div class="edit-field">
            <label><i class="fa-solid fa-triangle-exclamation"></i> Risk Level</label>
            <select [(ngModel)]="editDraft.riskLevel">
              <option value="Low">Low</option>
              <option value="Medium">Medium</option>
              <option value="High">High</option>
            </select>
          </div>

        </div>

        <div class="project-edit-actions">
          <button class="return-confirm-btn" (click)="saveEdit(p)">
            <i class="fa-solid fa-check"></i> Save Changes
          </button>
          <button class="return-cancel-btn" (click)="cancelEdit()">
            <i class="fa-solid fa-xmark"></i> Cancel
          </button>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="card-actions">

        <button class="action-btn return-btn"
                [class.active]="editingReturnId === p.id"
                (click)="toggleReturnEdit(p)">
          <i class="fa-solid fa-sack-dollar"></i>
          {{ editingReturnId === p.id ? 'Cancel' : (p.returnValue ? 'Edit Return' : 'Add Return') }}
        </button>

        <!-- ✏️ NEW EDIT BUTTON -->
        <button class="action-btn edit-btn"
                [class.active]="editingProjectId === p.id"
                (click)="toggleEditProject(p)">
          <i class="fa-solid" [ngClass]="editingProjectId === p.id ? 'fa-xmark' : 'fa-pen-to-square'"></i>
          {{ editingProjectId === p.id ? 'Cancel' : 'Edit' }}
        </button>

        <button class="action-btn delete-btn" (click)="delete(p.id)">
          <i class="fa-solid fa-trash"></i>
          Delete
        </button>

      </div>

    </div>
  </div>

<<<<<<< HEAD


  
</div>
=======
</div>
>>>>>>> d28c676382d72af177dc7fedade710e7b8f2d397
